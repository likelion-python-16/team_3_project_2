{% extends 'base.html' %}
{% load static %}

{% block title %}카페 트렌드 분석{% endblock %}

{% block content %}
<div class="container main">
    <div class="card">
        <div class="card__head">
            <h3>카페 트렌드 분석 <span class="tag">전체 {{ trends|length }}개 분석</span></h3>
        </div>
        
        {% if trends %}
            <div class="grid-4 kpi-grid" style="margin-top: 16px;">
                <div class="kpi">
                    <div class="t">전체 분석</div>
                    <div class="v">{{ trends|length }}개</div>
                </div>
                <div class="kpi">
                    <div class="t">트렌디 지역</div>
                    <div class="v up">{{ trends|dictsort:"is_trendy"|length }}개</div>
                </div>
                <div class="kpi">
                    <div class="t">위험 지역</div>
                    <div class="v warn">{{ trends|dictsort:"is_risk_area"|length }}개</div>
                </div>
                <div class="kpi">
                    <div class="t">성장 기대</div>
                    <div class="v up">{{ trends|dictsort:"is_growth_expectation"|length }}개</div>
                </div>
            </div>
            
            <div class="grid-2" style="gap: 16px; margin-top: 24px;">
                {% for trend in trends %}
                <div class="card">
                    <div class="card__head">
                        <h4>트렌드 #{{ trend.trend_id }}</h4>
                        <div>
                            {% if trend.is_trendy %}
                                <span class="chip" style="background: #e8f5e8; color: #2e7d32;">트렌디</span>
                            {% endif %}
                            {% if trend.is_risk_area %}
                                <span class="chip" style="background: #ffeaea; color: #d32f2f;">위험</span>
                            {% endif %}
                            {% if trend.is_growth_expectation %}
                                <span class="chip" style="background: #e3f2fd; color: #1976d2;">성장기대</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="grid-2" style="margin-top: 12px;">
                        <div class="kpi">
                            <div class="t">추천 등급</div>
                            <div class="v {% if trend.recommendation_level >= 8 %}up{% elif trend.recommendation_level >= 5 %}{% else %}warn{% endif %}">
                                {{ trend.recommendation_level }}/10
                            </div>
                        </div>
                        <div class="kpi">
                            <div class="t">예상 성장률</div>
                            <div class="v {% if trend.predicted_growth_rate > 0 %}up{% else %}warn{% endif %}">
                                {{ trend.predicted_growth_rate|floatformat:1 }}%
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 12px;">
                        <div class="stat">
                            <div>
                                <div class="k">투자 기회</div>
                                <div class="v {% if trend.investment_opportunity %}up{% else %}warn{% endif %}">
                                    {% if trend.investment_opportunity %}적합{% else %}부적합{% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 12px;">
                        <small class="muted">지역 정보: {{ trend.rp_key.traffic_level }}, 인구 {{ trend.rp_key.total_population|floatformat:0 }}명</small>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="panel panel--notice">
                <span>트렌드 분석 데이터가 없습니다.</span>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}