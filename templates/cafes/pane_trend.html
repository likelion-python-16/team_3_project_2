{% load static %}
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>íŠ¸ë Œë“œ ë¶„ì„</title>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
  <style>
    /* KPI í´ë¦­ ê°€ëŠ¥ ìŠ¤íƒ€ì¼ */
    .kpi .v {
      cursor: pointer;
      transition: all 0.2s ease;
      border-radius: 4px;
      padding: 2px 4px;
    }
    
    .kpi .v:hover {
      background-color: #f3f4f6;
      transform: scale(1.05);
    }
    
    /* ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ */
    .analysis-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .analysis-modal-overlay.active {
      display: flex;
    }
    
    /* ëª¨ë‹¬ ì»¨í…Œì´ë„ˆ */
    .analysis-modal {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease-out;
    }
    
    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    /* ëª¨ë‹¬ í—¤ë” */
    .analysis-modal-header {
      background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
      color: white;
      padding: 20px 24px;
      border-radius: 12px 12px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .analysis-modal-title {
      font-size: 20px;
      font-weight: bold;
      margin: 0;
    }
    
    .analysis-modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s ease;
    }
    
    .analysis-modal-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    /* ëª¨ë‹¬ ë‚´ìš© */
    .analysis-modal-content {
      padding: 24px;
    }
    
    /* í”¼ë“œ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .feed-card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
      border-left: 4px solid #3b82f6;
    }
    
    .feed-card h3 {
      margin: 0 0 12px 0;
      color: #1f2937;
    }
    
    .feed-meta {
      color: #6b7280;
      font-size: 14px;
      margin-bottom: 16px;
    }
    
    .feed-content {
      color: #374151;
      line-height: 1.6;
      margin-bottom: 16px;
    }
    
    .highlight-stat {
      background: #f3f4f6;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .stat-label {
      font-weight: 500;
      color: #374151;
    }
    
    .stat-value {
      font-size: 18px;
      font-weight: bold;
      color: #059669;
    }
    
    .stat-value.warning {
      color: #d97706;
    }
    
    .stat-value.danger {
      color: #dc2626;
    }
    
    .trending-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .trending-list li {
      padding: 12px 0;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .trending-list li:last-child {
      border-bottom: none;
    }
    
    .trend-up {
      color: #059669;
    }
    
    .trend-down {
      color: #dc2626;
    }
    
    /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
    .loading-spinner {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f4f6;
      border-top: 4px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="card tab-pane" id="pane-trend">
    <h3 id="trend-title">{{ selected_region }} íŠ¸ë Œë“œ ë¶„ì„</h3>
    <div class="grid-4 kpi-grid">
      <div class="kpi"><div class="t">3ë…„ ì„±ì¥ë¥ </div><div class="v up">+{{ three_year_growth }}%</div><div class="s">ì˜ˆì¸¡ ê¸°ë°˜</div></div>
      <div class="kpi"><div class="t">ì‹ ê·œ ì‚¬ì—…ì</div><div class="v up">+{{ new_businesses }}</div><div class="s">ì„±ì¥ ê¸°ëŒ€ ì§€ì—­</div></div>
      <div class="kpi"><div class="t">í‰ê·  ìƒì¡´ìœ¨</div><div class="v">{{ survival_rate }}%</div></div>
      <div class="kpi"><div class="t">ì›” í‰ê·  ë§¤ì¶œ ì§€ìˆ˜</div><div class="v">{{ sales_index }}</div><div class="s">ê¸°ì¤€=100</div></div>
    </div>
      
    <div class="bars">
      {% for category in trend_categories %}
      <div class="row">
        <div class="brand">{{ category.name }}</div>
        <div class="bar"><span style="width:{% widthratio category.growth_rate 200 100 %}%"></span></div>
        <div class="bar-meta">+{{ category.growth_rate }}% Â· {{ category.count }}ê°œ</div>
      </div>
      {% empty %}
      <div class="row"><div class="brand">í•„í„° ì¡°ê±´ì— ë§ëŠ” íŠ¸ë Œë“œê°€ ì—†ìŠµë‹ˆë‹¤</div></div>
      {% endfor %}
    </div>
  </div>

  <!-- ë¶„ì„ ëª¨ë‹¬ -->
  <div class="analysis-modal-overlay" id="analysisModal">
    <div class="analysis-modal">
      <div class="analysis-modal-header">
        <h2 class="analysis-modal-title" id="modalTitle">ìƒì„¸ ë¶„ì„</h2>
        <button class="analysis-modal-close" onclick="closeAnalysisModal()">&times;</button>
      </div>
      <div class="analysis-modal-content" id="modalContent">
        <div class="loading-spinner">
          <div class="spinner"></div>
        </div>
      </div>
    </div>
  </div>
</body>
<script type="text/javascript">
  // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì§€ì—­ ì •ë³´ ì½ê¸°
  const urlParams = new URLSearchParams(window.location.search);
  const selectedRegion = urlParams.get('region') || 'ì„œìš¸ì‹œ ì „ì²´';
  
  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì œëª© ì—…ë°ì´íŠ¸
  document.addEventListener('DOMContentLoaded', () => {
    const trendTitle = document.getElementById('trend-title');
    if (trendTitle) {
      trendTitle.innerHTML = `${selectedRegion} íŠ¸ë Œë“œ ë¶„ì„`;
    }
    
    // KPI í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    const kpiElements = document.querySelectorAll('.kpi .v');
    
    kpiElements.forEach((element, index) => {
      element.addEventListener('click', function(event) {
        event.stopPropagation();
        event.preventDefault();
        const kpiTitle = this.parentElement.querySelector('.t').textContent;
        openAnalysisModal(index, kpiTitle);
      });
    });
  });
  
  // ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
  function openAnalysisModal(kpiIndex, title) {
    const modal = document.getElementById('analysisModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalContent = document.getElementById('modalContent');
    
    // ëª¨ë‹¬ ì œëª© ì„¤ì •
    modalTitle.textContent = `${title} ìƒì„¸ ë¶„ì„`;
    
    // ë¡œë”© ìŠ¤í”¼ë„ˆ í‘œì‹œ
    modalContent.innerHTML = `
      <div class="loading-spinner">
        <div class="spinner"></div>
      </div>
    `;
    
    // ëª¨ë‹¬ í‘œì‹œ
    modal.classList.add('active');
    
    // API í˜¸ì¶œí•˜ì—¬ ë°ì´í„° ë¡œë“œ
    loadAnalysisData(kpiIndex, title);
  }
  
  // ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
  function closeAnalysisModal() {
    const modal = document.getElementById('analysisModal');
    modal.classList.remove('active');
  }
  
  // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
  document.getElementById('analysisModal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeAnalysisModal();
    }
  });
  
  // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeAnalysisModal();
    }
  });
  
  // ë¶„ì„ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
  function loadAnalysisData(kpiIndex, title) {
    const params = new URLSearchParams();
    
    // í˜„ì¬ í•„í„° ì¡°ê±´ ì¶”ê°€
    if (selectedRegion && selectedRegion !== 'ì„œìš¸ì‹œ ì „ì²´') {
      params.append('region', selectedRegion);
    }
    
    // KPIë³„ API ì—”ë“œí¬ì¸íŠ¸ ê²°ì •
    let apiEndpoint = '';
    switch(kpiIndex) {
      case 0: // 3ë…„ ì„±ì¥ë¥ 
        apiEndpoint = 'trend_three_year_growth_analysis';
        break;
      case 1: // ì‹ ê·œ ì‚¬ì—…ì
        apiEndpoint = 'trend_new_business_analysis';
        break;
      case 2: // í‰ê·  ìƒì¡´ìœ¨
        apiEndpoint = 'trend_survival_rate_analysis';
        break;
      case 3: // ì›” í‰ê·  ë§¤ì¶œ ì§€ìˆ˜
        apiEndpoint = 'trend_sales_index_analysis';
        break;
      default:
        apiEndpoint = 'trend_three_year_growth_analysis';
    }
    
    const apiUrl = `/api/cafes/cafes/${apiEndpoint}/?${params.toString()}`;
    console.log(`${title} ìƒì„¸ ë¶„ì„ API í˜¸ì¶œ:`, apiUrl);
    
    fetch(apiUrl)
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log(`${title} ë¶„ì„ ë°ì´í„° ìˆ˜ì‹ :`, data);
        renderAnalysisData(data, kpiIndex, title);
      })
      .catch(error => {
        console.error(`${title} ë¶„ì„ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:`, error);
        showErrorMessage();
      });
  }
  
  // ë¶„ì„ ë°ì´í„° ë Œë”ë§ í•¨ìˆ˜
  function renderAnalysisData(data, kpiIndex, title) {
    const modalContent = document.getElementById('modalContent');
    let html = '';
    
    switch(kpiIndex) {
      case 0: // 3ë…„ ì„±ì¥ë¥  ë¶„ì„
        html = renderThreeYearGrowthAnalysis(data);
        break;
      case 1: // ì‹ ê·œ ì‚¬ì—…ì ë¶„ì„
        html = renderNewBusinessAnalysis(data);
        break;
      case 2: // í‰ê·  ìƒì¡´ìœ¨ ë¶„ì„
        html = renderSurvivalRateAnalysis(data);
        break;
      case 3: // ì›” í‰ê·  ë§¤ì¶œ ì§€ìˆ˜ ë¶„ì„
        html = renderSalesIndexAnalysis(data);
        break;
    }
    
    modalContent.innerHTML = html;
  }
  
  // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
  function showErrorMessage() {
    const modalContent = document.getElementById('modalContent');
    modalContent.innerHTML = `
      <div class="feed-card">
        <h3>âŒ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨</h3>
        <div class="feed-content">
          ì£„ì†¡í•©ë‹ˆë‹¤. ë¶„ì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
          ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.
        </div>
      </div>
    `;
  }
  
  // 3ë…„ ì„±ì¥ë¥  ë¶„ì„ ë Œë”ë§
  function renderThreeYearGrowthAnalysis(data) {
    return `
      <div class="feed-card">
        <h3>ğŸ“ˆ 3ë…„ ì„±ì¥ë¥  íŠ¸ë Œë“œ ë¶„ì„</h3>
        <div class="feed-meta">ìµœê·¼ 3ë…„ê°„ ì¹´í˜ ì—…ê³„ ì„±ì¥ë¥  ìƒì„¸ ë¶„ì„</div>
        
        <div class="highlight-stat">
          <span class="stat-label">3ë…„ í‰ê·  ì„±ì¥ë¥ </span>
          <span class="stat-value">${data.three_year_growth || 0}%</span>
        </div>
        
        <div class="highlight-stat">
          <span class="stat-label">ì—°í‰ê·  ì„±ì¥ë¥ </span>
          <span class="stat-value">${data.annual_avg_growth || 0}%</span>
        </div>
        
        <div class="highlight-stat">
          <span class="stat-label">ìµœê³  ì„±ì¥ ì—°ë„</span>
          <span class="stat-value">${data.peak_growth_year || '2023'}ë…„</span>
        </div>
      </div>
      
      <div class="feed-card">
        <h3>ğŸ“Š ì—°ë„ë³„ ì„±ì¥ë¥ </h3>
        <div class="feed-meta">ìµœê·¼ 3ë…„ê°„ ì—°ë„ë³„ ì„±ì¥ë¥  ë³€í™”</div>
        
        <ul class="trending-list">
          ${(data.yearly_growth || []).map(item => `
            <li>
              <span>${item.year || '2023'}ë…„</span>
              <span class="${(item.growth_rate || 0) >= 0 ? 'trend-up' : 'trend-down'}">
                ${item.growth_rate || 0}%
              </span>
            </li>
          `).join('')}
        </ul>
      </div>
      
      <div class="feed-card">
        <h3>ğŸ¯ ì„±ì¥ ë™ë ¥</h3>
        <div class="feed-meta">3ë…„ê°„ ì„±ì¥ì„ ì´ëˆ ì£¼ìš” ìš”ì¸</div>
        
        <div class="feed-content">
          <div style="margin-bottom: 16px;">
            <strong>ğŸŸ¢ ì£¼ìš” ì„±ì¥ ë™ë ¥:</strong> ${data.growth_drivers || 'ë°°ë‹¬ ì„œë¹„ìŠ¤ í™•ì‚°, ì›ë‘ í’ˆì§ˆ í–¥ìƒ, ê³µê°„ ë‹¤ì–‘í™”'}
          </div>
          
          <div style="margin-bottom: 16px;">
            <strong>ğŸŸ¡ ì£¼ì˜ ìš”ì¸:</strong> ${data.caution_factors || 'ì„ëŒ€ë£Œ ìƒìŠ¹, ì¸ê±´ë¹„ ì¦ê°€'}
          </div>
          
          <div>
            <strong>ğŸ”® í–¥í›„ ì „ë§:</strong> ${data.future_outlook || 'ì•ˆì •ì  ì„±ì¥ì„¸ ì§€ì† ì˜ˆìƒ'}
          </div>
        </div>
      </div>
    `;
  }
  
  // ì‹ ê·œ ì‚¬ì—…ì ë¶„ì„ ë Œë”ë§
  function renderNewBusinessAnalysis(data) {
    return `
      <div class="feed-card">
        <h3>ğŸ†• ì‹ ê·œ ì‚¬ì—…ì í˜„í™© ë¶„ì„</h3>
        <div class="feed-meta">ìƒˆë¡œ ì§„ì…í•˜ëŠ” ì¹´í˜ ì‚¬ì—…ì ë¶„ì„</div>
        
        <div class="highlight-stat">
          <span class="stat-label">ì›”í‰ê·  ì‹ ê·œ ì‚¬ì—…ì</span>
          <span class="stat-value">${data.new_businesses || 0}ê°œ</span>
        </div>
        
        <div class="highlight-stat">
          <span class="stat-label">ì „ë…„ ë™ê¸° ëŒ€ë¹„</span>
          <span class="stat-value ${(data.yoy_change || 0) >= 0 ? '' : 'danger'}">${data.yoy_change || 0}%</span>
        </div>
        
        <div class="highlight-stat">
          <span class="stat-label">ì„±ê³µë¥ </span>
          <span class="stat-value">${data.success_rate || 0}%</span>
        </div>
      </div>
      
      <div class="feed-card">
        <h3>ğŸ¢ ì‹ ê·œ ì‚¬ì—…ì ìœ í˜•</h3>
        <div class="feed-meta">ì‹ ê·œ ì§„ì… ì‚¬ì—…ìì˜ ìœ í˜•ë³„ ë¶„í¬</div>
        
        <ul class="trending-list">
          <li>
            <span>í”„ëœì°¨ì´ì¦ˆ</span>
            <span class="trend-up">${data.new_franchise || 0}ê°œ</span>
          </li>
          <li>
            <span>ê°œì¸ì¹´í˜</span>
            <span class="trend-up">${data.new_individual || 0}ê°œ</span>
          </li>
          <li>
            <span>ì¹´í˜í˜• ë³µí•©ë§¤ì¥</span>
            <span class="trend-up">${data.new_hybrid || 0}ê°œ</span>
          </li>
        </ul>
      </div>
      
      <div class="feed-card">
        <h3>ğŸ“ ì‹ ê·œ ì§„ì… ì„ í˜¸ ì§€ì—­</h3>
        <div class="feed-meta">ì‹ ê·œ ì‚¬ì—…ìë“¤ì´ ì„ í˜¸í•˜ëŠ” ì§€ì—­</div>
        
        <ul class="trending-list">
          ${(data.preferred_areas || []).map(item => `
            <li>
              <span>${item.area_name || 'ê¸°íƒ€'}</span>
              <span class="trend-up">${item.new_count || 0}ê°œ</span>
            </li>
          `).join('')}
        </ul>
      </div>
      
      <div class="feed-card">
        <h3>ğŸ’¡ ì‹ ê·œ ì‚¬ì—…ì ì„±ê³µ ìš”ì¸</h3>
        <div class="feed-meta">ì„±ê³µì ì¸ ì¹´í˜ ì°½ì—…ì„ ìœ„í•œ í•µì‹¬ ìš”ì†Œ</div>
        
        <div class="feed-content">
          ì„±ê³µí•˜ëŠ” ì‹ ê·œ ì¹´í˜ì˜ ê³µí†µì ì€ <strong>${data.success_factors || 'ì°¨ë³„í™”ëœ ì»¨ì…‰, ì¢‹ì€ ì…ì§€, í’ˆì§ˆ ê´€ë¦¬'}</strong>ì´ë©°,
          íŠ¹íˆ <strong>${data.key_success_factor || 'ê³ ê° ì„œë¹„ìŠ¤'}</strong>ê°€ ê°€ì¥ ì¤‘ìš”í•œ ìš”ì†Œë¡œ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤.
        </div>
      </div>
    `;
  }
  
  // í‰ê·  ìƒì¡´ìœ¨ ë¶„ì„ ë Œë”ë§
  function renderSurvivalRateAnalysis(data) {
    return `
      <div class="feed-card">
        <h3>ğŸ’ª ì¹´í˜ ìƒì¡´ìœ¨ ë¶„ì„</h3>
        <div class="feed-meta">ì¹´í˜ ì‚¬ì—…ì˜ ì§€ì†ì„± ë° ìƒì¡´ìœ¨ ë¶„ì„</div>
        
        <div class="highlight-stat">
          <span class="stat-label">ì „ì²´ í‰ê·  ìƒì¡´ìœ¨</span>
          <span class="stat-value">${data.survival_rate || 0}%</span>
        </div>
        
        <div class="highlight-stat">
          <span class="stat-label">3ë…„ ìƒì¡´ìœ¨</span>
          <span class="stat-value">${data.three_year_survival || 0}%</span>
        </div>
        
        <div class="highlight-stat">
          <span class="stat-label">5ë…„ ìƒì¡´ìœ¨</span>
          <span class="stat-value">${data.five_year_survival || 0}%</span>
        </div>
      </div>
      
      <div class="feed-card">
        <h3>ğŸ“Š ìœ í˜•ë³„ ìƒì¡´ìœ¨</h3>
        <div class="feed-meta">ì¹´í˜ ìœ í˜•ë³„ ìƒì¡´ìœ¨ ë¹„êµ</div>
        
        <ul class="trending-list">
          <li>
            <span>ëŒ€í˜• í”„ëœì°¨ì´ì¦ˆ</span>
            <span class="trend-up">${data.franchise_survival || 0}%</span>
          </li>
          <li>
            <span>ê°œì¸ì¹´í˜</span>
            <span class="trend-up">${data.individual_survival || 0}%</span>
          </li>
          <li>
            <span>ì†Œí˜• í”„ëœì°¨ì´ì¦ˆ</span>
            <span class="trend-up">${data.small_franchise_survival || 0}%</span>
          </li>
        </ul>
      </div>
      
      <div class="feed-card">
        <h3>âš ï¸ íì—… ìœ„í—˜ ìš”ì¸</h3>
        <div class="feed-meta">ì¹´í˜ íì—…ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ì£¼ìš” ìš”ì¸</div>
        
        <ul class="trending-list">
          <li>
            <span>ë§¤ì¶œ ë¶€ì§„</span>
            <span class="trend-down">${data.low_sales_risk || 0}%</span>
          </li>
          <li>
            <span>ë†’ì€ ì„ëŒ€ë£Œ</span>
            <span class="trend-down">${data.high_rent_risk || 0}%</span>
          </li>
          <li>
            <span>ê²½ìŸ ê³¼ì—´</span>
            <span class="trend-down">${data.competition_risk || 0}%</span>
          </li>
        </ul>
      </div>
      
      <div class="feed-card">
        <h3>ğŸ¯ ìƒì¡´ìœ¨ í–¥ìƒ ë°©ì•ˆ</h3>
        <div class="feed-meta">ì¹´í˜ ìš´ì˜ ì§€ì†ì„±ì„ ë†’ì´ëŠ” ë°©ë²•</div>
        
        <div class="feed-content">
          ìƒì¡´ìœ¨ì´ ë†’ì€ ì¹´í˜ë“¤ì˜ ê³µí†µì ì¸ íŠ¹ì§•ì€ <strong>${data.survival_strategies || 'ê¾¸ì¤€í•œ í’ˆì§ˆ ê´€ë¦¬, ê³ ê° ê´€ê³„ ê´€ë¦¬, ì ì ˆí•œ ë§ˆì¼€íŒ…'}</strong>ì´ë©°,
          íŠ¹íˆ <strong>${data.key_survival_factor || 'ì§€ì†ì ì¸ ë©”ë‰´ ê°œë°œ'}</strong>ì´ ì¤‘ìš”í•œ ê²ƒìœ¼ë¡œ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤.
        </div>
      </div>
    `;
  }
  
  // ë§¤ì¶œ ì§€ìˆ˜ ë¶„ì„ ë Œë”ë§
  function renderSalesIndexAnalysis(data) {
    return `
      <div class="feed-card">
        <h3>ğŸ’° ë§¤ì¶œ ì§€ìˆ˜ ë¶„ì„</h3>
        <div class="feed-meta">ì¹´í˜ ì—…ê³„ ë§¤ì¶œ ì§€ìˆ˜ ìƒì„¸ ë¶„ì„ (ê¸°ì¤€=100)</div>
        
        <div class="highlight-stat">
          <span class="stat-label">í˜„ì¬ ë§¤ì¶œ ì§€ìˆ˜</span>
          <span class="stat-value">${data.sales_index || 100}</span>
        </div>
        
        <div class="highlight-stat">
          <span class="stat-label">ì „ì›” ëŒ€ë¹„</span>
          <span class="stat-value ${(data.monthly_change || 0) >= 0 ? '' : 'danger'}">${data.monthly_change || 0}%</span>
        </div>
        
        <div class="highlight-stat">
          <span class="stat-label">ì „ë…„ ë™ì›” ëŒ€ë¹„</span>
          <span class="stat-value ${(data.yearly_change || 0) >= 0 ? '' : 'danger'}">${data.yearly_change || 0}%</span>
        </div>
      </div>
      
      <div class="feed-card">
        <h3>ğŸ“Š ì›”ë³„ ë§¤ì¶œ ì§€ìˆ˜ ì¶”ì´</h3>
        <div class="feed-meta">ìµœê·¼ 12ê°œì›” ë§¤ì¶œ ì§€ìˆ˜ ë³€í™”</div>
        
        <ul class="trending-list">
          ${(data.monthly_index || []).map(item => `
            <li>
              <span>${item.month || '1'}ì›”</span>
              <span class="${(item.index || 100) >= 100 ? 'trend-up' : 'trend-down'}">
                ${item.index || 100}
              </span>
            </li>
          `).join('')}
        </ul>
      </div>
      
      <div class="feed-card">
        <h3>ğŸ¯ ì§€ì—­ë³„ ë§¤ì¶œ ì§€ìˆ˜</h3>
        <div class="feed-meta">ì§€ì—­ë³„ ë§¤ì¶œ ì§€ìˆ˜ ë¹„êµ</div>
        
        <ul class="trending-list">
          ${(data.regional_index || []).map(item => `
            <li>
              <span>${item.region || 'ê¸°íƒ€'}</span>
              <span class="${(item.index || 100) >= 100 ? 'trend-up' : 'trend-down'}">
                ${item.index || 100}
              </span>
            </li>
          `).join('')}
        </ul>
      </div>
      
      <div class="feed-card">
        <h3>ğŸ“ˆ ë§¤ì¶œ ì§€ìˆ˜ ì˜í–¥ ìš”ì¸</h3>
        <div class="feed-meta">ë§¤ì¶œ ì§€ìˆ˜ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ì£¼ìš” ìš”ì¸</div>
        
        <div class="feed-content">
          <div style="margin-bottom: 16px;">
            <strong>ğŸŸ¢ ê¸ì • ìš”ì¸:</strong> ${data.positive_factors || 'ì†Œë¹„ ì‹¬ë¦¬ íšŒë³µ, ì™¸ì‹ ë¬¸í™” í™•ì‚°, í”„ë¦¬ë¯¸ì—„ ì»¤í”¼ ì„ í˜¸'}
          </div>
          
          <div style="margin-bottom: 16px;">
            <strong>ğŸŸ¡ ì¤‘ë¦½ ìš”ì¸:</strong> ${data.neutral_factors || 'ê³„ì ˆì  ë³€ë™, ê²½ìŸ ì¦ê°€'}
          </div>
          
          <div>
            <strong>ğŸ”´ ë¶€ì • ìš”ì¸:</strong> ${data.negative_factors || 'ì›ìì¬ ê°€ê²© ìƒìŠ¹, ì¸ê±´ë¹„ ì¦ê°€'}
          </div>
        </div>
      </div>
    `;
  }
</script>
</html>
