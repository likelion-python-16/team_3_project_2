{% load static %}
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë‚´ ê³„ì • - ê³¨ëª©ìƒê¶Œ ë¹…ë°ì´í„° ë¶„ì„</title>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
  <style>
    .account-hero {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: white;
      padding: 40px 0;
    }
    
    .account-container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    
    .account-grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 40px;
      margin-top: 40px;
    }
    
    .account-sidebar {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
      height: fit-content;
    }
    
    .account-main {
      background: white;
      border-radius: 12px;
      padding: 32px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
    }
    
    .profile-section {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 32px;
      font-weight: bold;
      margin: 0 auto 16px auto;
    }
    
    .subscription-card {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      transition: all 0.3s ease;
    }
    
    .subscription-card.premium {
      border-color: #3b82f6;
      background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
    }
    
    .subscription-card.free {
      border-color: #d1d5db;
    }
    
    .subscription-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .subscription-title {
      font-size: 20px;
      font-weight: bold;
      margin: 0;
    }
    
    .subscription-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .subscription-badge.premium {
      background: #3b82f6;
      color: white;
    }
    
    .subscription-badge.free {
      background: #6b7280;
      color: white;
    }
    
    .usage-bar {
      background: #f3f4f6;
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      margin: 16px 0;
    }
    
    .usage-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981, #059669);
      transition: width 0.3s ease;
    }
    
    .usage-fill.warning {
      background: linear-gradient(90deg, #f59e0b, #d97706);
    }
    
    .usage-fill.danger {
      background: linear-gradient(90deg, #ef4444, #dc2626);
    }
    
    .payment-history {
      margin-top: 32px;
    }
    
    .payment-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .payment-item:last-child {
      border-bottom: none;
    }
    
    .payment-status {
      padding: 4px 8px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .payment-status.completed {
      background: #dcfce7;
      color: #166534;
    }
    
    .payment-status.pending {
      background: #fef3c7;
      color: #92400e;
    }
    
    .payment-status.failed {
      background: #fecaca;
      color: #991b1b;
    }
    
    .payment-status.cancelled {
      background: #f3f4f6;
      color: #6b7280;
    }
    
    .btn-upgrade {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 16px;
    }
    
    .btn-upgrade:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
    }
    
    .feature-list {
      list-style: none;
      padding: 0;
      margin: 16px 0;
    }
    
    .feature-list li {
      padding: 8px 0;
      color: #374151;
      display: flex;
      align-items: center;
    }
    
    .feature-list li::before {
      content: "âœ“";
      color: #10b981;
      font-weight: bold;
      margin-right: 8px;
    }
    
    .feature-list li.disabled {
      color: #9ca3af;
    }
    
    .feature-list li.disabled::before {
      content: "âœ—";
      color: #ef4444;
    }
    
    @media (max-width: 768px) {
      .account-grid {
        grid-template-columns: 1fr;
        gap: 24px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="topbar">
    <div class="container topbar__row">
      <div class="logo">
        <a href="/" style="text-decoration: none; color: inherit;">
          <span>ğŸ§­</span>
          <span class="logo__title">ê³¨ëª©ìƒê¶Œ ë¹…ë°ì´í„° ë¶„ì„</span>
        </a>
      </div>
      <nav class="top-actions">
        <a href="/" class="btn btn--ghost">ëŒ€ì‹œë³´ë“œ</a>
        <form action="/api/accounts/users/logout/" method="post" style="display: inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn--ghost">ë¡œê·¸ì•„ì›ƒ</button>
        </form>
      </nav>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="account-hero">
    <div class="container">
      <h1>ë‚´ ê³„ì •</h1>
      <p>êµ¬ë… í˜„í™©ê³¼ ì‚¬ìš©ëŸ‰ì„ í™•ì¸í•˜ê³  í”Œëœì„ ê´€ë¦¬í•˜ì„¸ìš”</p>
    </div>
  </section>

  <!-- Main Content -->
  <div class="account-container">
    <div class="account-grid">
      
      <!-- Sidebar -->
      <aside class="account-sidebar">
        <div class="profile-section">
          <div class="profile-avatar">
            {{ user.username|first|upper }}
          </div>
          <h3>{{ user.username }}</h3>
          <p style="color: #6b7280; margin: 0;">{{ user.email }}</p>
        </div>
        
        <div style="border-top: 1px solid #e5e7eb; padding-top: 24px;">
          <h4 style="margin: 0 0 16px 0;">ê³„ì • ì„¤ì •</h4>
          <ul style="list-style: none; padding: 0; margin: 0;">
            <li><a href="#profile" style="color: #374151; text-decoration: none; display: block; padding: 8px 0;">í”„ë¡œí•„ ìˆ˜ì •</a></li>
            <li><a href="#subscription" style="color: #374151; text-decoration: none; display: block; padding: 8px 0;">êµ¬ë… ê´€ë¦¬</a></li>
            <li><a href="#billing" style="color: #374151; text-decoration: none; display: block; padding: 8px 0;">ê²°ì œ ë‚´ì—­</a></li>
            <li><a href="#support" style="color: #374151; text-decoration: none; display: block; padding: 8px 0;">ê³ ê° ì§€ì›</a></li>
          </ul>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="account-main">
        
        <!-- Current Subscription -->
        <section id="subscription">
          <h2>í˜„ì¬ êµ¬ë… í”Œëœ</h2>
          
          {% if user.profile.is_premium %}
          <div class="subscription-card premium">
            <div class="subscription-header">
              <h3 class="subscription-title">í”„ë¦¬ë¯¸ì—„ í”Œëœ</h3>
              <span class="subscription-badge premium">í™œì„±í™”</span>
            </div>
            
            <p style="color: #374151; margin: 8px 0;">
              êµ¬ë… ë§Œë£Œì¼: {{ user.profile.subscription_end|date:"Yë…„ mì›” dì¼" }}
            </p>
            
            <ul class="feature-list">
              <li>ë¬´ì œí•œ ë¶„ì„ ì¡°íšŒ</li>
              <li>ìƒì„¸ ì§€ì—­ë³„ ë¶„ì„</li>
              <li>AI íˆ¬ì ì¶”ì²œ</li>
              <li>ë°ì´í„° ë‚´ë³´ë‚´ê¸°</li>
              <li>ìš°ì„  ê³ ê° ì§€ì›</li>
            </ul>
            
            <button class="btn-upgrade" onclick="extendSubscription()">
              êµ¬ë… ì—°ì¥í•˜ê¸°
            </button>
          </div>
          {% else %}
          <div class="subscription-card free">
            <div class="subscription-header">
              <h3 class="subscription-title">ë¬´ë£Œ í”Œëœ</h3>
              <span class="subscription-badge free">í™œì„±í™”</span>
            </div>
            
            <p style="color: #6b7280; margin: 16px 0;">
              ì˜¤ëŠ˜ ì‚¬ìš©ëŸ‰: {{ user.profile.daily_usage_count }}/10íšŒ
            </p>
            
            <div class="usage-bar">
              <div class="usage-fill {% if user.profile.daily_usage_count >= 8 %}danger{% elif user.profile.daily_usage_count >= 6 %}warning{% endif %}" 
                   style="width: {% widthratio user.profile.daily_usage_count 1 10 %}%"></div>
            </div>
            
            <ul class="feature-list">
              <li>ì¼ì¼ ë¶„ì„ ì¡°íšŒ 10íšŒ</li>
              <li>ê¸°ë³¸ ìƒê¶Œ ë¶„ì„</li>
              <li>í”„ëœì°¨ì´ì¦ˆ ë¶„ì„</li>
              <li class="disabled">ìƒì„¸ íˆ¬ì ë¶„ì„</li>
              <li class="disabled">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</li>
              <li class="disabled">ìš°ì„  ê³ ê° ì§€ì›</li>
            </ul>
            
            <button class="btn-upgrade" onclick="upgradeSubscription()">
              í”„ë¦¬ë¯¸ì—„ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ â‚©9,500/ì›”
            </button>
          </div>
          {% endif %}
        </section>

        <!-- Payment History -->
        <section id="billing" class="payment-history">
          <h2>ê²°ì œ ë‚´ì—­</h2>
          
          {% if payments %}
            {% for payment in payments %}
            <div class="payment-item">
              <div>
                <div style="font-weight: 500;">í”„ë¦¬ë¯¸ì—„ í”Œëœ ({{ payment.subscription_months }}ê°œì›”)</div>
                <div style="color: #6b7280; font-size: 14px;">
                  {{ payment.created_at|date:"Yë…„ mì›” dì¼ H:i" }}
                  {% if payment.order_id %}
                    | ì£¼ë¬¸ë²ˆí˜¸: {{ payment.order_id }}
                  {% endif %}
                </div>
                {% if payment.payment_method %}
                  <div style="color: #9ca3af; font-size: 12px;">
                    ê²°ì œìˆ˜ë‹¨: {{ payment.payment_method }}
                  </div>
                {% endif %}
              </div>
              <div style="text-align: right;">
                <div style="font-weight: 500;">â‚©{{ payment.amount|floatformat:0 }}</div>
                <span class="payment-status {{ payment.status }}">
                  {{ payment.get_status_display }}
                </span>
                {% if payment.approved_at %}
                  <div style="color: #6b7280; font-size: 12px; margin-top: 4px;">
                    ìŠ¹ì¸: {{ payment.approved_at|date:"m/d H:i" }}
                  </div>
                {% endif %}
              </div>
            </div>
            {% endfor %}
          {% else %}
            <div style="text-align: center; padding: 40px 0;">
              <div style="font-size: 48px; margin-bottom: 16px;">ğŸ’³</div>
              <p style="color: #6b7280; margin: 0;">
                ì•„ì§ ê²°ì œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
              </p>
              <p style="color: #9ca3af; font-size: 14px; margin: 8px 0 0 0;">
                í”„ë¦¬ë¯¸ì—„ í”Œëœì„ êµ¬ë…í•˜ë©´ ì—¬ê¸°ì—ì„œ ê²°ì œ ë‚´ì—­ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
              </p>
            </div>
          {% endif %}
        </section>

        <!-- Profile Settings -->
        <section id="profile" style="margin-top: 40px; border-top: 1px solid #e5e7eb; padding-top: 32px;">
          <h2>í”„ë¡œí•„ ì„¤ì •</h2>
          
          <form id="profile-form">
            {% csrf_token %}
            <div style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 8px; font-weight: 500;">ì‚¬ìš©ìëª…</label>
              <input type="text" value="{{ user.username }}" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;" readonly>
            </div>
            
            <div style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 8px; font-weight: 500;">ì´ë©”ì¼</label>
              <input type="email" value="{{ user.email }}" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;" readonly>
            </div>
            
            <p style="color: #6b7280; font-size: 14px;">
              í”„ë¡œí•„ ì •ë³´ ìˆ˜ì •ì„ ì›í•˜ì‹œë©´ ê³ ê° ì§€ì›íŒ€ì— ë¬¸ì˜í•´ ì£¼ì„¸ìš”.
            </p>
          </form>
        </section>

      </main>
    </div>
  </div>

  <script>
    function upgradeSubscription() {
      if (confirm('í”„ë¦¬ë¯¸ì—„ í”Œëœìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì›” 9,500ì›ìœ¼ë¡œ ë¬´ì œí•œ ë¶„ì„ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
        // í† ìŠ¤ í˜ì´ë¨¼ì¸  ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™
        window.location.href = '/payment/?plan=premium';
      }
    }
    
    function extendSubscription() {
      if (confirm('í”„ë¦¬ë¯¸ì—„ êµ¬ë…ì„ 1ê°œì›” ì—°ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        // í† ìŠ¤ í˜ì´ë¨¼ì¸  ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™
        window.location.href = '/payment/?plan=premium&extend=true';
      }
    }
    
    // ì‹¤ì‹œê°„ ì‚¬ìš©ëŸ‰ ì—…ë°ì´íŠ¸
    async function updateUsage() {
      try {
        const response = await fetch('/api/accounts/usage/');
        const data = await response.json();
        
        if (data.success) {
          const usageCount = document.querySelector('.usage-fill');
          if (usageCount) {
            const percentage = (data.daily_usage / 10) * 100;
            usageCount.style.width = percentage + '%';
            
            // ì‚¬ìš©ëŸ‰ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
            usageCount.className = 'usage-fill';
            if (percentage >= 80) {
              usageCount.classList.add('danger');
            } else if (percentage >= 60) {
              usageCount.classList.add('warning');
            }
          }
        }
      } catch (error) {
        console.error('Usage update failed:', error);
      }
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ëŸ‰ ì—…ë°ì´íŠ¸
    document.addEventListener('DOMContentLoaded', function() {
      {% if not user.profile.is_premium %}
        updateUsage();
        // 5ë¶„ë§ˆë‹¤ ì‚¬ìš©ëŸ‰ ì—…ë°ì´íŠ¸
        setInterval(updateUsage, 300000);
      {% endif %}
    });
  </script>
</body>
</html>